(library (constraints-tests)
  (export run-constraints-tests)
  (import (chezscheme) (ui) (test-runner) (state) (constraints) (failure) (var) (streams) (package) (datatypes))

  (define (run-constraints-tests)
    (define x0 (make-var 0))
    (define x1 (make-var 1))
    
    (tassert "disunify ground-self" (run* (q) (=/= 1 1)) '())
    (tassert "disunify ground-different" (run* () (=/= 1 2)) '(()))
    (tassert "disunify free-self" (run* (x0) (=/= x0 x0)) '())
    (tassert "disunify free-ground" (constraint-goal (run1 (x0) (=/= x0 0))) (=/= x0 0))
    (tassert "disunify ground-free" (constraint-goal (run1 (x0) (=/= 0 x0))) (=/= x0 0))
    (tassert "disunify free-free" (map constraint-goal (run1 (x0 x1) (=/= x0 x1)))
	     (list (=/= x0 x1) (=/= x0 x1)))
    (tassert "disunify bound" (run* (x0) (== x0 0) (=/= x0 0)) '())
    (display "BOUND\n")
    (tassert "disunify check" (run* (x0) (=/= x0 0) (== x0 0)) '())
    (tassert "disunify free-ground x2" (constraint-goal (run1 (x0) (=/= x0 1) (=/= x0 0)))
	     (conj* (=/= x0 0) (=/= x0 1)))
    (tassert "disunify transfer to free then check" (run* (x0 x1) (=/= x0 1) (== x0 x1) (== x1 1)) '())
    (display "LISTS\n")
    (tassert "disunify lists" (constraint-goal (car (run1 (x0 x1) (=/= (cons x0 x1) (cons 0 1)))))
	     (disj* (=/= x0 0) (=/= x1 1)))    
    (tassert "disunify fire lists" (run1 (x0 x1) (=/= (cons x0 x1) (cons 0 1)) (== x0 0))
	     (list 0 (set-constraint-goal empty-constraint (=/= x1 1))))
    (tassert "disunify fire lists and fail" (run* (x0 x1) (=/= (cons x0 x1) (cons 0 1)) (== x0 0) (== x1 1))
	     '())
    
    ))
